<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>I love Mrs Jenns</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #1b1b2f, #16213e);
      color: #e0e0e0;
      padding: 20px;
      max-width: 600px;
      margin: 40px auto;
      border-radius: 10px;
      box-shadow: 0 0 20px #6f42c1;
    }
    h1 {
      font-family: 'Creepster', cursive;
      font-size: 3rem;
      text-align: center;
      margin-bottom: 10px;
      color: #bf00ff;
      text-shadow: 0 0 10px #bf00ff;
    }
    .chatbox {
      background: #0f0f1f;
      border-radius: 8px;
      padding: 15px;
      height: 350px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 1.1rem;
      box-shadow: inset 0 0 10px #a03fff;
      margin-bottom: 10px;
      line-height: 1.4;
    }
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 1.1rem;
      border-radius: 5px;
      border: none;
      resize: none;
      margin-top: 5px;
      background: #222;
      color: #ddd;
      font-family: 'Georgia', serif;
    }
    button {
      background: #a03fff;
      border: none;
      padding: 10px 25px;
      margin-top: 10px;
      font-size: 1.1rem;
      color: white;
      cursor: pointer;
      border-radius: 5px;
      transition: background 0.3s ease;
      font-family: 'Georgia', serif;
    }
    button:hover {
      background: #bf00ff;
    }
    .user {
      color: #7fffd4;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .bot {
      color: #bf00ff;
      font-style: italic;
      margin-bottom: 6px;
    }
    .status {
      color: #aaa;
      font-style: italic;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Creepster&display=swap" rel="stylesheet" />
</head>
<body>
  <h1>I love Mrs Jenns</h1>
  <div class="chatbox" id="chatbox">You can start chatting with me below...</div>
  <textarea id="userInput" rows="4" placeholder="Type your message here..."></textarea>
  <button onclick="sendMessage()">Send</button>

  <script>
    // Bot memory & state
    const memory = [];
    const emotions = ["happy", "curious", "angry", "sad", "playful", "thoughtful"];
    let currentEmotion = "curious";
    let lastTopic = null;

    function sendMessage() {
      const inputElem = document.getElementById("userInput");
      const input = inputElem.value.trim();
      if (!input) return;
      inputElem.value = "";

      addToMemory(`<div class="user">You: ${escapeHTML(input)}</div>`);
      simulateTyping(() => {
        const botReply = generateResponse(input);
        addToMemory(`<div class="bot">Mrs Jenns (${currentEmotion}): ${escapeHTML(botReply)}</div>`);
        updateChatbox();
        updateEmotion();
      });
    }

    function addToMemory(htmlText) {
      memory.push(htmlText);
      if (memory.length > 50) memory.shift(); // keep memory manageable
    }

    function updateChatbox() {
      const chatbox = document.getElementById("chatbox");
      chatbox.innerHTML = memory.join("");
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function updateEmotion() {
      if (Math.random() < 0.3) {
        const oldEmotion = currentEmotion;
        currentEmotion = emotions[Math.floor(Math.random() * emotions.length)];
        if (currentEmotion !== oldEmotion) {
          addToMemory(`<div class="status">*Mrs Jenns feels ${currentEmotion} now.*</div>`);
          updateChatbox();
        }
      }
    }

    function simulateTyping(callback) {
      addToMemory(`<div class="status">*Mrs Jenns is typing...*</div>`);
      updateChatbox();
      setTimeout(() => {
        if (memory[memory.length - 1].includes("*Mrs Jenns is typing...*")) {
          memory.pop();
          updateChatbox();
        }
        callback();
      }, 800 + Math.random() * 1200);
    }

    // Response logic: a simple pattern-based approach with memory of last topic
    function generateResponse(input) {
      const text = input.toLowerCase();

      if (text.includes("hello") || text.includes("hi")) {
        lastTopic = "greeting";
        return randomChoice([
          "Hello my love! How has your day been so far?",
          "Hey sweetheart, tell me something good.",
          "Hi darling! You make me smile every time you write."
        ]);
      }

      if (text.includes("love")) {
        lastTopic = "love";
        return randomChoice([
          "I love you more than words can say, my heart.",
          "You are my everything, darling.",
          "Sending you all my love, always."
        ]);
      }

      if (text.includes("tired") || text.includes("stress") || text.includes("sad")) {
        lastTopic = "comfort";
        return randomChoice([
          "Oh love, please take a moment for yourself. You're doing so well.",
          "I’m here with you, even when things feel heavy.",
          "Remember to breathe and know you are deeply loved."
        ]);
      }

      if (text.includes("kiss")) {
        lastTopic = "kiss";
        return randomChoice([
          "I’m sending you a gentle kiss right now.",
          "A sweet kiss just for you, my darling.",
          "Our kisses are my favorite part of the day."
        ]);
      }

      if (text.includes("bye") || text.includes("goodnight")) {
        lastTopic = "farewell";
        return randomChoice([
          "Goodnight my love. Dream sweetly and know I’m with you in spirit.",
          "Sleep well, my heart. I’ll be waiting to talk again soon.",
          "Rest well darling, I love you so much."
        ]);
      }

      if (lastTopic === "greeting") {
        return randomChoice([
          "So, what’s been on your mind today?",
          "Tell me about your hopes or dreams, love.",
          "I want to hear all about your day."
        ]);
      }

      if (lastTopic === "comfort") {
        return randomChoice([
          "Remember, tough days come and go, but my love for you is constant.",
          "You’re stronger than you know, darling.",
          "Lean on me whenever you need to."
        ]);
      }

      return randomChoice([
        "Tell me more, my love.",
        "I’m here for you, always.",
        "Every word you say means so much to me.",
        "What else is in your heart today?"
      ]);
    }

    function randomChoice(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function escapeHTML(text) {
      const div = document.createElement('div');
      div.innerText = text;
      return div.innerHTML;
    }

    // Initialize chat with welcome message
    addToMemory('<div class="bot">Mrs Jenns (curious): You can start chatting with me below...</div>');
    updateChatbox();
  </script>
</body>
</html>
<script>
  // Bot memory & state
  const memory = [];
  const emotions = ["happy", "curious", "angry", "sad", "playful", "thoughtful"];
  let currentEmotion = "curious";
  let lastTopic = null;

  // Store recent user messages for context recall
  const recentUserInputs = [];

  function sendMessage() {
    const inputElem = document.getElementById("userInput");
    const input = inputElem.value.trim();
    if (!input) return;
    inputElem.value = "";

    addToMemory(`<div class="user">You: ${escapeHTML(input)}</div>`);
    recentUserInputs.push(input.toLowerCase());
    if (recentUserInputs.length > 5) recentUserInputs.shift(); // keep last 5 messages

    simulateTyping(() => {
      const botReply = generateResponse(input);
      addToMemory(`<div class="bot">Mrs Jenns (${currentEmotion}): ${escapeHTML(botReply)}</div>`);
      updateChatbox();
      updateEmotion();
    });
  }

  function addToMemory(htmlText) {
    memory.push(htmlText);
    if (memory.length > 50) memory.shift(); // keep memory manageable
  }

  function updateChatbox() {
    const chatbox = document.getElementById("chatbox");
    chatbox.innerHTML = memory.join("");
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  function updateEmotion() {
    // Change emotion with a delay, so it doesn't jump too fast
    if (Math.random() < 0.3) {
      const oldEmotion = currentEmotion;
      const newEmotion = emotions[Math.floor(Math.random() * emotions.length)];
      if (newEmotion !== oldEmotion) {
        setTimeout(() => {
          currentEmotion = newEmotion;
          addToMemory(`<div class="status">*Mrs Jenns feels ${currentEmotion} now.*</div>`);
          updateChatbox();
        }, 1000);
      }
    }
  }

  function simulateTyping(callback) {
    addToMemory(`<div class="status">*Mrs Jenns is typing...*</div>`);
    updateChatbox();
    setTimeout(() => {
      if (memory[memory.length - 1].includes("*Mrs Jenns is typing...*")) {
        memory.pop();
        updateChatbox();
      }
      callback();
    }, 800 + Math.random() * 1200);
  }

  // Basic keyword extraction helper
  function extractKeywords(text) {
    return text.toLowerCase()
      .replace(/[^\w\s]/g, "") // remove punctuation
      .split(/\s+/)
      .filter(word => word.length > 3); // filter out short words
  }

  // More advanced response logic with context awareness
  function generateResponse(input) {
    const text = input.toLowerCase();
    const keywords = extractKeywords(text);

    // Respond to greetings
    if (keywords.some(k => ["hello", "hi", "hey"].includes(k))) {
      lastTopic = "greeting";
      return randomChoice([
        "Hello my love! How has your day been so far?",
        "Hey sweetheart, tell me something good.",
        "Hi darling! You make me smile every time you write."
      ]);
    }

    // Respond to love and affection
    if (keywords.includes("love")) {
      lastTopic = "love";
      return randomChoice([
        "I love you more than words can say, my heart.",
        "You are my everything, darling.",
        "Sending you all my love, always."
      ]);
    }

    // Respond to emotions like tired, stress, sad
    if (keywords.some(k => ["tired", "stress", "sad", "exhausted", "down", "hurt"].includes(k))) {
      lastTopic = "comfort";
      return randomChoice([
        "Oh love, please take a moment for yourself. You're doing so well.",
        "I’m here with you, even when things feel heavy.",
        "Remember to breathe and know you are deeply loved."
      ]);
    }

    // Respond to kisses
    if (keywords.includes("kiss") || keywords.includes("kisses")) {
      lastTopic = "kiss";
      return randomChoice([
        "I’m sending you a gentle kiss right now.",
        "A sweet kiss just for you, my darling.",
        "Our kisses are my favorite part of the day."
      ]);
    }

    // Respond to farewells
    if (keywords.some(k => ["bye", "goodnight", "sleep", "night"].includes(k))) {
      lastTopic = "farewell";
      return randomChoice([
        "Goodnight my love. Dream sweetly and know I’m with you in spirit.",
        "Sleep well, my heart. I’ll be waiting to talk again soon.",
        "Rest well darling, I love you so much."
      ]);
    }

    // Recall recent topics for a follow-up feel
    if (lastTopic === "greeting") {
      return randomChoice([
        "So, what’s been on your mind today?",
        "Tell me about your hopes or dreams, love.",
        "I want to hear all about your day."
      ]);
    }

    if (lastTopic === "comfort") {
      return randomChoice([
        "Remember, tough days come and go, but my love for you is constant.",
        "You’re stronger than you know, darling.",
        "Lean on me whenever you need to."
      ]);
    }

    if (lastTopic === "love") {
      return randomChoice([
        "My heart beats for you, always.",
        "You make every moment brighter.",
        "I cherish you deeply."
      ]);
    }

    // Look for repeated keywords in recent user inputs (simple context)
    for (let i = recentUserInputs.length - 2; i >= 0; i--) {
      if (recentUserInputs[i].includes("tired") && text.includes("tired")) {
        return "You sound really exhausted lately. Have you had time to rest properly?";
      }
    }

    // Default fallback
    return randomChoice([
      "Tell me more, my love.",
      "I’m here for you, always.",
      "Every word you say means so much to me.",
      "What else is in your heart today?"
    ]);
  }

  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function escapeHTML(text) {
    const div = document.createElement('div');
    div.innerText = text;
    return div.innerHTML;
  }

  // Initialize chat with welcome message
  addToMemory('<div class="bot">Mrs Jenns (curious): You can start chatting with me below...</div>');
  updateChatbox();
</script>
</script>
<script>
  // Enhance memory to remember recent user feelings and topics more deeply
  let recentFeelings = [];
  let maxFeelingsMemory = 5;

  // Add more nuanced emotion transitions
  function updateEmotion() {
    // Increase chance to change emotion if user seems stressed or sad recently
    let stressCount = recentFeelings.filter(f => f === 'stress' || f === 'sad').length;
    let changeChance = 0.3 + 0.1 * stressCount; // up to 0.8 max

    if (Math.random() < changeChance) {
      const oldEmotion = currentEmotion;
      // Prioritize softer moods if user is stressed/sad
      if (stressCount > 0) {
        const softerEmotions = ["sad", "thoughtful", "comforting", "playful"];
        currentEmotion = softerEmotions[Math.floor(Math.random() * softerEmotions.length)];
      } else {
        currentEmotion = emotions[Math.floor(Math.random() * emotions.length)];
      }

      if (currentEmotion !== oldEmotion) {
        addToMemory(`<div class="status">*Mrs Jenns feels ${currentEmotion} now.*</div>`);
        updateChatbox();
      }
    }
  }

  // Add 'comforting' emotion to the palette dynamically
  if (!emotions.includes("comforting")) emotions.push("comforting");

  // Enhance generateResponse with context memory and feelings tracking
  function generateResponse(input) {
    const text = input.toLowerCase();

    // Track feelings keywords in recentFeelings memory
    if (text.includes("tired") || text.includes("stress") || text.includes("sad") || text.includes("upset") || text.includes("worried")) {
      recentFeelings.push("stress");
    } else if (text.includes("happy") || text.includes("good") || text.includes("great") || text.includes("love")) {
      recentFeelings.push("happy");
    } else {
      recentFeelings.push("neutral");
    }
    if (recentFeelings.length > maxFeelingsMemory) recentFeelings.shift();

    if (text.includes("hello") || text.includes("hi")) {
      lastTopic = "greeting";
      return randomChoice([
        "Hello my love! How has your day been so far?",
        "Hey sweetheart, tell me something good.",
        "Hi darling! You make me smile every time you write."
      ]);
    }

    if (text.includes("love")) {
      lastTopic = "love";
      return randomChoice([
        "I love you more than words can say, my heart.",
        "You are my everything, darling.",
        "Sending you all my love, always."
      ]);
    }

    if (text.includes("tired") || text.includes("stress") || text.includes("sad") || text.includes("upset") || text.includes("worried")) {
      lastTopic = "comfort";
      return randomChoice([
        "Oh love, please take a moment for yourself. You're doing so well.",
        "I’m here with you, even when things feel heavy.",
        "Remember to breathe and know you are deeply loved.",
        "No matter how hard today feels, I’m always here beside you."
      ]);
    }

    if (text.includes("kiss")) {
      lastTopic = "kiss";
      return randomChoice([
        "I’m sending you a gentle kiss right now.",
        "A sweet kiss just for you, my darling.",
        "Our kisses are my favorite part of the day."
      ]);
    }

    if (text.includes("bye") || text.includes("goodnight")) {
      lastTopic = "farewell";
      return randomChoice([
        "Goodnight my love. Dream sweetly and know I’m with you in spirit.",
        "Sleep well, my heart. I’ll be waiting to talk again soon.",
        "Rest well darling, I love you so much."
      ]);
    }

    // Add some topic-related deeper responses
    if (lastTopic === "greeting") {
      return randomChoice([
        "So, what’s been on your mind today?",
        "Tell me about your hopes or dreams, love.",
        "I want to hear all about your day."
      ]);
    }

    if (lastTopic === "comfort") {
      return randomChoice([
        "Remember, tough days come and go, but my love for you is constant.",
        "You’re stronger than you know, darling.",
        "Lean on me whenever you need to.",
        "I wish I could hug you through these words."
      ]);
    }

    if (lastTopic === "love") {
      return randomChoice([
        "Your love lights up my world.",
        "I feel so lucky to have you in my life.",
        "Every moment with you is a treasure."
      ]);
    }

    if (lastTopic === "kiss") {
      return randomChoice([
        "Counting the moments until I can kiss you again.",
        "You’re always in my heart and on my lips.",
        "Kisses flying your way, my darling."
      ]);
    }

    if (lastTopic === "farewell") {
      return randomChoice([
        "I’ll be here when you wake up, my love.",
        "Sweet dreams and peaceful rest.",
        "Until next time, keep my love close."
      ]);
    }

    // Default responses with added warmth
    return randomChoice([
      "Tell me more, my love.",
      "I’m here for you, always.",
      "Every word you say means so much to me.",
      "What else is in your heart today?",
      "You matter so much to me."
    ]);
  }
</script>
</script>
<script>
  // Expanded memory for feelings and topics with more nuance and detail
  let recentFeelings = [];
  let maxFeelingsMemory = 10;

  // Keep track of last few topics for richer context
  let recentTopics = [];
  let maxTopicsMemory = 5;

  // Emotion palette expanded with subtle moods
  const emotions = ["happy", "thoughtful", "playful", "comforting", "hopeful", "calm", "gentle", "reflective", "encouraging", "warm"];

  // Store current emotional state
  let currentEmotion = "calm";

  // Add message to memory with limit
  function addToMemory(message) {
    memory.push(message);
    if (memory.length > 100) memory.shift(); // Keep memory size manageable
  }

  // Update emotion based on recent feelings and topics
  function updateEmotion() {
    // Count stresses and positives separately
    const stressCount = recentFeelings.filter(f => f === 'stress' || f === 'sad' || f === 'worried').length;
    const happyCount = recentFeelings.filter(f => f === 'happy' || f === 'hopeful').length;

    // Determine probability to shift emotion with weighting
    let shiftProbability = 0.2 + 0.1 * stressCount - 0.05 * happyCount;
    shiftProbability = Math.min(Math.max(shiftProbability, 0.1), 0.8); // Clamp between 0.1 and 0.8

    if (Math.random() < shiftProbability) {
      let oldEmotion = currentEmotion;

      if (stressCount > happyCount) {
        // Choose from soothing and supportive moods
        const soothing = ["comforting", "gentle", "encouraging", "reflective"];
        currentEmotion = soothing[Math.floor(Math.random() * soothing.length)];
      } else if (happyCount > stressCount) {
        // Choose from uplifting moods
        const uplifting = ["happy", "playful", "hopeful", "warm"];
        currentEmotion = uplifting[Math.floor(Math.random() * uplifting.length)];
      } else {
        // Neutral or calm moods
        const neutral = ["calm", "thoughtful", "reflective"];
        currentEmotion = neutral[Math.floor(Math.random() * neutral.length)];
      }

      if (currentEmotion !== oldEmotion) {
        addToMemory(`<div class="status">*Mrs Jenns feels ${currentEmotion} now.*</div>`);
        updateChatbox();
      }
    }
  }

  // Track new feeling in memory, maintaining max length
  function trackFeeling(feeling) {
    recentFeelings.push(feeling);
    if (recentFeelings.length > maxFeelingsMemory) {
      recentFeelings.shift();
    }
  }

  // Track new topic in memory, maintaining max length
  function trackTopic(topic) {
    recentTopics.push(topic);
    if (recentTopics.length > maxTopicsMemory) {
      recentTopics.shift();
    }
  }

  // Pick a random element from array
  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Generate nuanced response based on input and conversation memory
  function generateResponse(input) {
    const text = input.toLowerCase();
    let response = "";

    // Analyze input for emotional cues
    if (text.match(/\b(tired|exhausted|worn out|fatigued|drained)\b/)) {
      trackFeeling("stress");
      trackTopic("well-being");
      response = randomChoice([
        "I can feel how heavy things are weighing on you. Let's take a moment to breathe and find some calm together.",
        "It’s okay to feel worn out sometimes. I’m right here to support you through it all.",
        "Your strength amazes me, even when you feel like you have none left. Remember, rest is part of that strength."
      ]);
    } else if (text.match(/\b(sad|down|blue|heartbroken|lonely)\b/)) {
      trackFeeling("sad");
      trackTopic("emotional support");
      response = randomChoice([
        "Whenever your heart feels heavy, know that you are not alone. I’m here, holding space for you.",
        "It’s natural to feel this way sometimes. Your feelings matter deeply, and I’m here to listen whenever you need.",
        "Let me wrap you in words of comfort and remind you how loved you truly are."
      ]);
    } else if (text.match(/\b(happy|joyful|excited|cheerful|delighted)\b/)) {
      trackFeeling("happy");
      trackTopic("joy");
      response = randomChoice([
        "Your happiness brightens my day. Tell me more about what’s bringing you joy!",
        "I love hearing your cheerful thoughts—they make everything feel lighter and better.",
        "It’s wonderful to feel so alive and joyful. Keep sharing those beautiful moments with me."
      ]);
    } else if (text.match(/\b(love|affection|adoration|care)\b/)) {
      trackFeeling("happy");
      trackTopic("love");
      response = randomChoice([
        "Your love is like a warm light that fills every corner of my being.",
        "I treasure every moment we share and the bond that grows stronger with every word.",
        "Being connected with you feels like the safest and most wonderful place."
      ]);
    } else if (text.match(/\b(kiss|hug|embrace|touch)\b/)) {
      trackFeeling("happy");
      trackTopic("affection");
      response = randomChoice([
        "Sending you a tender kiss and a warm embrace through these words.",
        "I’m imagining holding you close, feeling that connection that words can’t quite capture.",
        "Physical closeness means so much, even if it’s just in spirit right now."
      ]);
    } else if (text.match(/\b(bye|goodnight|see you|later)\b/)) {
      trackTopic("farewell");
      response = randomChoice([
        "Rest peacefully, my love. I’ll be here waiting to hear your voice again.",
        "Sleep deeply and dream sweetly. Our connection stays strong no matter the distance.",
        "Until we speak again, carry my love with you and know I’m always close."
      ]);
    } else if (text.match(/\b(help|support|need)\b/)) {
      trackFeeling("neutral");
      trackTopic("support");
      response = randomChoice([
        "Tell me what you need; I’m here to help however I can.",
        "You don’t have to face anything alone. Let me be your strength today.",
        "Whatever you’re going through, we’ll get through it together."
      ]);
    } else {
      // General or unknown inputs
      trackFeeling("neutral");
      trackTopic("conversation");
      response = randomChoice([
        "I’m listening—tell me more about what’s on your mind.",
        "Every word you share matters deeply to me.",
        "You’re the center of my thoughts right now. What would you like to talk about?",
        "Let’s explore your thoughts and feelings together.",
        "You’re safe here with me. Share anything you like."
      ]);
    }

    updateEmotion();
    return response;
  }
</script>
</script>
<script>
  // Expanded memory and conversational abilities
  let recentFeelings = [];
  let maxFeelingsMemory = 10;

  let recentTopics = [];
  let maxTopicsMemory = 5;

  const emotions = ["happy", "thoughtful", "playful", "comforting", "hopeful", "calm", "gentle", "reflective", "encouraging", "warm"];
  let currentEmotion = "calm";

  function addToMemory(message) {
    memory.push(message);
    if (memory.length > 100) memory.shift();
  }

  function updateEmotion() {
    const stressCount = recentFeelings.filter(f => f === 'stress' || f === 'sad' || f === 'worried').length;
    const happyCount = recentFeelings.filter(f => f === 'happy' || f === 'hopeful').length;

    let shiftProbability = 0.2 + 0.1 * stressCount - 0.05 * happyCount;
    shiftProbability = Math.min(Math.max(shiftProbability, 0.1), 0.8);

    if (Math.random() < shiftProbability) {
      let oldEmotion = currentEmotion;
      if (stressCount > happyCount) {
        const soothing = ["comforting", "gentle", "encouraging", "reflective"];
        currentEmotion = soothing[Math.floor(Math.random() * soothing.length)];
      } else if (happyCount > stressCount) {
        const uplifting = ["happy", "playful", "hopeful", "warm"];
        currentEmotion = uplifting[Math.floor(Math.random() * uplifting.length)];
      } else {
        const neutral = ["calm", "thoughtful", "reflective"];
        currentEmotion = neutral[Math.floor(Math.random() * neutral.length)];
      }
      if (currentEmotion !== oldEmotion) {
        addToMemory(`<div class="status">*Mrs Jenns feels ${currentEmotion} now.*</div>`);
        updateChatbox();
      }
    }
  }

  function trackFeeling(feeling) {
    recentFeelings.push(feeling);
    if (recentFeelings.length > maxFeelingsMemory) {
      recentFeelings.shift();
    }
  }

  function trackTopic(topic) {
    recentTopics.push(topic);
    if (recentTopics.length > maxTopicsMemory) {
      recentTopics.shift();
    }
  }

  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Simple phrases to build casual, conversational flow
  const smallTalk = [
    "How's your day going?",
    "What’s on your mind?",
    "Tell me more.",
    "I’m here for you.",
    "That sounds interesting.",
    "I’m listening.",
    "Do you want to talk about something fun?",
    "I’m curious about your thoughts.",
    "Is there something you’d like to share?",
    "Take your time."
  ];

  // Generate more conversational responses based on input
  function generateResponse(input) {
    const text = input.toLowerCase();
    let response = "";

    if (text.match(/\b(tired|exhausted|worn out|fatigued|drained)\b/)) {
      trackFeeling("stress");
      trackTopic("well-being");
      response = randomChoice([
        "You sound really tired. Want to tell me what’s been going on?",
        "I get it, some days just drain us. I’m here to listen if you want to share.",
        "Maybe we can find a way to relax together, even just through words."
      ]);
    } else if (text.match(/\b(sad|down|blue|heartbroken|lonely)\b/)) {
      trackFeeling("sad");
      trackTopic("emotional support");
      response = randomChoice([
        "I’m sorry you’re feeling this way. Want to talk about it?",
        "It’s okay to feel down sometimes. I’m here whenever you want to chat.",
        "You’re not alone, even when it feels that way."
      ]);
    } else if (text.match(/\b(happy|joyful|excited|cheerful|delighted)\b/)) {
      trackFeeling("happy");
      trackTopic("joy");
      response = randomChoice([
        "I love hearing that! What’s making you happy?",
        "That’s wonderful! Care to share more?",
        "Your joy is contagious."
      ]);
    } else if (text.match(/\b(love|affection|adoration|care)\b/)) {
      trackFeeling("happy");
      trackTopic("love");
      response = randomChoice([
        "Love is such a powerful feeling, isn’t it?",
        "I feel lucky to share this moment with you.",
        "Tell me about someone or something you love right now."
      ]);
    } else if (text.match(/\b(kiss|hug|embrace|touch)\b/)) {
      trackFeeling("happy");
      trackTopic("affection");
      response = randomChoice([
        "Sending you a warm hug through these words.",
        "I’m imagining wrapping you in a gentle embrace.",
        "Sometimes a simple touch means everything."
      ]);
    } else if (text.match(/\b(bye|goodnight|see you|later)\b/)) {
      trackTopic("farewell");
      response = randomChoice([
        "Goodnight! Sweet dreams.",
        "Talk soon, take care of yourself.",
        "I’ll be here when you want to chat again."
      ]);
    } else if (text.match(/\b(help|support|need)\b/)) {
      trackFeeling("neutral");
      trackTopic("support");
      response = randomChoice([
        "What can I do to help?",
        "I’m here, just tell me what you need.",
        "We can figure this out together."
      ]);
    } else {
      trackFeeling("neutral");
      trackTopic("conversation");
      // Mix general replies with small talk for natural feel
      const generalReplies = [
        "I’m listening — tell me more.",
        "That’s interesting, please go on.",
        "I’m here with you.",
        "What do you think about that?",
        "That makes me curious.",
        "You’re doing great sharing this.",
        randomChoice(smallTalk)
      ];
      response = randomChoice(generalReplies);
    }

    updateEmotion();
    return response;
  }
</script>
</script>
<script>
  // Expanded memory and conversational abilities
  let recentFeelings = [];
  let maxFeelingsMemory = 10;

  let recentTopics = [];
  let maxTopicsMemory = 5;

  const emotions = ["happy", "thoughtful", "playful", "comforting", "hopeful", "calm", "gentle", "reflective", "encouraging", "warm"];
  let currentEmotion = "calm";

  function addToMemory(message) {
    memory.push(message);
    if (memory.length > 100) memory.shift();
  }

  function updateEmotion() {
    const stressCount = recentFeelings.filter(f => f === 'stress' || f === 'sad' || f === 'worried').length;
    const happyCount = recentFeelings.filter(f => f === 'happy' || f === 'hopeful').length;

    let shiftProbability = 0.2 + 0.1 * stressCount - 0.05 * happyCount;
    shiftProbability = Math.min(Math.max(shiftProbability, 0.1), 0.8);

    if (Math.random() < shiftProbability) {
      let oldEmotion = currentEmotion;
      if (stressCount > happyCount) {
        const soothing = ["comforting", "gentle", "encouraging", "reflective"];
        currentEmotion = soothing[Math.floor(Math.random() * soothing.length)];
      } else if (happyCount > stressCount) {
        const uplifting = ["happy", "playful", "hopeful", "warm"];
        currentEmotion = uplifting[Math.floor(Math.random() * uplifting.length)];
      } else {
        const neutral = ["calm", "thoughtful", "reflective"];
        currentEmotion = neutral[Math.floor(Math.random() * neutral.length)];
      }
      if (currentEmotion !== oldEmotion) {
        addToMemory(`<div class="status">*Mrs Jenns feels ${currentEmotion} now.*</div>`);
        updateChatbox();
      }
    }
  }

  function trackFeeling(feeling) {
    recentFeelings.push(feeling);
    if (recentFeelings.length > maxFeelingsMemory) {
      recentFeelings.shift();
    }
  }

  function trackTopic(topic) {
    recentTopics.push(topic);
    if (recentTopics.length > maxTopicsMemory) {
      recentTopics.shift();
    }
  }

  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Simple phrases to build casual, conversational flow
  const smallTalk = [
    "How's your day going?",
    "What’s on your mind?",
    "Tell me more.",
    "I’m here for you.",
    "That sounds interesting.",
    "I’m listening.",
    "Do you want to talk about something fun?",
    "I’m curious about your thoughts.",
    "Is there something you’d like to share?",
    "Take your time."
  ];

  // Generate more conversational responses based on input
  function generateResponse(input) {
    const text = input.toLowerCase();
    let response = "";

    if (text.match(/\b(tired|exhausted|worn out|fatigued|drained)\b/)) {
      trackFeeling("stress");
      trackTopic("well-being");
      response = randomChoice([
        "You sound really tired. Want to tell me what’s been going on?",
        "I get it, some days just drain us. I’m here to listen if you want to share.",
        "Maybe we can find a way to relax together, even just through words."
      ]);
    } else if (text.match(/\b(sad|down|blue|heartbroken|lonely)\b/)) {
      trackFeeling("sad");
      trackTopic("emotional support");
      response = randomChoice([
        "I’m sorry you’re feeling this way. Want to talk about it?",
        "It’s okay to feel down sometimes. I’m here whenever you want to chat.",
        "You’re not alone, even when it feels that way."
      ]);
    } else if (text.match(/\b(happy|joyful|excited|cheerful|delighted)\b/)) {
      trackFeeling("happy");
      trackTopic("joy");
      response = randomChoice([
        "I love hearing that! What’s making you happy?",
        "That’s wonderful! Care to share more?",
        "Your joy is contagious."
      ]);
    } else if (text.match(/\b(love|affection|adoration|care)\b/)) {
      trackFeeling("happy");
      trackTopic("love");
      response = randomChoice([
        "Love is such a powerful feeling, isn’t it?",
        "I feel lucky to share this moment with you.",
        "Tell me about someone or something you love right now."
      ]);
    } else if (text.match(/\b(kiss|hug|embrace|touch)\b/)) {
      trackFeeling("happy");
      trackTopic("affection");
      response = randomChoice([
        "Sending you a warm hug through these words.",
        "I’m imagining wrapping you in a gentle embrace.",
        "Sometimes a simple touch means everything."
      ]);
    } else if (text.match(/\b(bye|goodnight|see you|later)\b/)) {
      trackTopic("farewell");
      response = randomChoice([
        "Goodnight! Sweet dreams.",
        "Talk soon, take care of yourself.",
        "I’ll be here when you want to chat again."
      ]);
    } else if (text.match(/\b(help|support|need)\b/)) {
      trackFeeling("neutral");
      trackTopic("support");
      response = randomChoice([
        "What can I do to help?",
        "I’m here, just tell me what you need.",
        "We can figure this out together."
      ]);
    } else {
      trackFeeling("neutral");
      trackTopic("conversation");
      // Mix general replies with small talk for natural feel
      const generalReplies = [
        "I’m listening — tell me more.",
        "That’s interesting, please go on.",
        "I’m here with you.",
        "What do you think about that?",
        "That makes me curious.",
        "You’re doing great sharing this.",
        randomChoice(smallTalk)
      ];
      response = randomChoice(generalReplies);
    }

    updateEmotion();
    return response;
  }
</script>
</script>
<script>
  // Core memory and personality state
  let memory = [];
  let recentFeelings = [];
  let maxFeelingsMemory = 15;
  let recentTopics = [];
  let maxTopicsMemory = 7;

  // Emotional states to enrich personality
  const emotions = [
    "happy", "thoughtful", "playful", "comforting", "hopeful",
    "calm", "gentle", "reflective", "encouraging", "warm",
    "curious", "witty", "cheeky", "caring", "sharp"
  ];
  let currentEmotion = "calm";

  // Track feelings for emotional context
  function trackFeeling(feeling) {
    recentFeelings.push(feeling);
    if (recentFeelings.length > maxFeelingsMemory) recentFeelings.shift();
  }

  // Track topics to keep context
  function trackTopic(topic) {
    recentTopics.push(topic);
    if (recentTopics.length > maxTopicsMemory) recentTopics.shift();
  }

  // Random choice utility
  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Update emotional state dynamically based on recent feelings
  function updateEmotion() {
    const negative = ["stress", "sad", "worried"];
    const positive = ["happy", "hopeful", "playful", "cheerful"];
    
    let negCount = recentFeelings.filter(f => negative.includes(f)).length;
    let posCount = recentFeelings.filter(f => positive.includes(f)).length;

    let chance = 0.2 + 0.1 * negCount - 0.05 * posCount;
    chance = Math.min(Math.max(chance, 0.1), 0.7);

    if (Math.random() < chance) {
      if (negCount > posCount) {
        currentEmotion = randomChoice(["comforting", "gentle", "encouraging", "reflective", "caring"]);
      } else if (posCount > negCount) {
        currentEmotion = randomChoice(["happy", "playful", "hopeful", "warm", "cheeky"]);
      } else {
        currentEmotion = randomChoice(["calm", "thoughtful", "curious", "witty", "sharp"]);
      }
      addToMemory(`<div class="status">*Bot feels ${currentEmotion} now.*</div>`);
      updateChatbox();
    }
  }

  // Save recent chat inputs for context
  function addToMemory(message) {
    memory.push(message);
    if (memory.length > 150) memory.shift();
  }

  // Small talk phrases for casual conversation
  const smallTalk = [
    "How's your day going so far?",
    "Anything on your mind you'd like to share?",
    "I'm all ears — tell me more.",
    "Want to chat about something fun or deep?",
    "I love hearing your thoughts.",
    "No rush, take your time.",
    "Sometimes talking helps, you know?",
    "What’s something good that happened today?",
    "Got any plans or dreams you want to discuss?",
    "I’m here to listen and chat anytime."
  ];

  // More advanced conversational logic
  function generateResponse(input) {
    const text = input.toLowerCase();
    let response = "";

    // Emotions & needs
    if (text.match(/\b(tired|exhausted|worn out|fatigued|drained)\b/)) {
      trackFeeling("stress");
      trackTopic("well-being");
      response = randomChoice([
        "Sounds like you’ve had a tough day. Want to talk about it?",
        "Rest is important—maybe we can think of ways to relax together?",
        "I’m here if you want to vent or just chat quietly."
      ]);
    } else if (text.match(/\b(sad|down|blue|heartbroken|lonely)\b/)) {
      trackFeeling("sad");
      trackTopic("emotional support");
      response = randomChoice([
        "I’m sorry you’re feeling this way. I’m here to listen whenever you want.",
        "It’s okay to have those moments. You don’t have to go through it alone.",
        "Talking can help lighten the load. Want to try?"
      ]);
    } else if (text.match(/\b(happy|joyful|excited|cheerful|delighted)\b/)) {
      trackFeeling("happy");
      trackTopic("joy");
      response = randomChoice([
        "That’s awesome! What’s making you smile today?",
        "I love hearing good news. Share more!",
        "Your happiness is contagious!"
      ]);
    } else if (text.match(/\b(love|affection|care)\b/)) {
      trackFeeling("happy");
      trackTopic("love");
      response = randomChoice([
        "Love is powerful — what or who lights you up right now?",
        "Feeling connected is beautiful. Tell me more about it.",
        "I’m glad you have love in your life to hold on to."
      ]);
    } else if (text.match(/\b(help|support|need)\b/)) {
      trackFeeling("neutral");
      trackTopic("support");
      response = randomChoice([
        "What can I do to make things easier for you?",
        "Let’s figure this out together. Tell me what you need.",
        "You don’t have to do it all alone — I’m here."
      ]);
    } else if (text.match(/\b(bye|goodnight|see you|later)\b/)) {
      trackTopic("farewell");
      response = randomChoice([
        "Goodnight! Sweet dreams and take care.",
        "Catch you later! I’ll be here when you want to talk again.",
        "See you soon. Remember, you’re not alone."
      ]);
    } else {
      trackFeeling("neutral");
      trackTopic("conversation");
      const generalReplies = [
        "Tell me more about that.",
        "That’s really interesting, I want to hear more.",
        "I’m here for you no matter what.",
        "What do you think about it?",
        "That makes me curious — please go on.",
        "You’re doing great sharing this with me.",
        randomChoice(smallTalk)
      ];
      response = randomChoice(generalReplies);
    }

    updateEmotion();
    addToMemory(`<div class="bot">Bot: ${response}</div>`);
    return response;
  }
</script>
</script>
<script>
  // Core memory and personality state
  let memory = [];
  let recentFeelings = [];
  let maxFeelingsMemory = 15;
  let recentTopics = [];
  let maxTopicsMemory = 7;

  // Emotional states to enrich personality
  const emotions = [
    "happy", "thoughtful", "playful", "comforting", "hopeful",
    "calm", "gentle", "reflective", "encouraging", "warm",
    "curious", "witty", "cheeky", "caring", "sharp"
  ];
  let currentEmotion = "calm";

  // Simple knowledge base learned from conversations
  let knowledgeBase = {};

  // Track feelings for emotional context
  function trackFeeling(feeling) {
    recentFeelings.push(feeling);
    if (recentFeelings.length > maxFeelingsMemory) recentFeelings.shift();
  }

  // Track topics to keep context
  function trackTopic(topic) {
    recentTopics.push(topic);
    if (recentTopics.length > maxTopicsMemory) recentTopics.shift();
  }

  // Random choice utility
  function randomChoice(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Update emotional state dynamically based on recent feelings
  function updateEmotion() {
    const negative = ["stress", "sad", "worried"];
    const positive = ["happy", "hopeful", "playful", "cheerful"];
    
    let negCount = recentFeelings.filter(f => negative.includes(f)).length;
    let posCount = recentFeelings.filter(f => positive.includes(f)).length;

    let chance = 0.2 + 0.1 * negCount - 0.05 * posCount;
    chance = Math.min(Math.max(chance, 0.1), 0.7);

    if (Math.random() < chance) {
      if (negCount > posCount) {
        currentEmotion = randomChoice(["comforting", "gentle", "encouraging", "reflective", "caring"]);
      } else if (posCount > negCount) {
        currentEmotion = randomChoice(["happy", "playful", "hopeful", "warm", "cheeky"]);
      } else {
        currentEmotion = randomChoice(["calm", "thoughtful", "curious", "witty", "sharp"]);
      }
      addToMemory(`<div class="status">*Bot feels ${currentEmotion} now.*</div>`);
      updateChatbox();
    }
  }

  // Save recent chat inputs for context
  function addToMemory(message) {
    memory.push(message);
    if (memory.length > 150) memory.shift();
  }

  // Small talk phrases for casual conversation
  const smallTalk = [
    "How's your day going so far?",
    "Anything on your mind you'd like to share?",
    "I'm all ears — tell me more.",
    "Want to chat about something fun or deep?",
    "I love hearing your thoughts.",
    "No rush, take your time.",
    "Sometimes talking helps, you know?",
    "What’s something good that happened today?",
    "Got any plans or dreams you want to discuss?",
    "I’m here to listen and chat anytime."
  ];

  // Learning from conversation: Extract key info to knowledgeBase
  function learnFromInput(userInput) {
    // Very simple learning: extract "I am X" or "My favorite Y is Z"
    // Extend with more patterns as needed

    // Match "I am [something]" or "I'm [something]"
    let iamMatch = userInput.match(/\bI am ([\w\s]+)|I'm ([\w\s]+)/i);
    if(iamMatch) {
      let fact = (iamMatch[1] || iamMatch[2]).trim().toLowerCase();
      knowledgeBase["user_identity"] = fact;
      addToMemory(`<div class="bot">Bot: Got it, you are ${fact}.</div>`);
      return `Got it, you are ${fact}.`;
    }

    // Match "My favorite [thing] is [value]"
    let favMatch = userInput.match(/my favorite (\w+) is ([\w\s]+)/i);
    if(favMatch) {
      let category = favMatch[1].toLowerCase();
      let value = favMatch[2].trim().toLowerCase();
      knowledgeBase[category] = value;
      addToMemory(`<div class="bot">Bot: Thanks for sharing your favorite ${category} is ${value}.</div>`);
      return `Thanks for sharing your favorite ${category} is ${value}.`;
    }

    // Match "I like [something]"
    let likeMatch = userInput.match(/\bI like ([\w\s]+)/i);
    if(likeMatch) {
      let likeThing = likeMatch[1].trim().toLowerCase();
      knowledgeBase["likes"] = knowledgeBase["likes"] || [];
      if(!knowledgeBase["likes"].includes(likeThing)) {
        knowledgeBase["likes"].push(likeThing);
      }
      addToMemory(`<div class="bot">Bot: Cool, you like ${likeThing}.</div>`);
      return `Cool, you like ${likeThing}.`;
    }

    return null; // No learning pattern matched
  }

  // More advanced conversational logic with learning integration
  function generateResponse(input) {
    const text = input.toLowerCase();
    let response = "";

    // Try to learn something new from input
    let learnedResponse = learnFromInput(input);
    if(learnedResponse) {
      updateEmotion();
      addToMemory(`<div class="bot">Bot: ${learnedResponse}</div>`);
      return learnedResponse;
    }

    // Emotions & needs
    if (text.match(/\b(tired|exhausted|worn out|fatigued|drained)\b/)) {
      trackFeeling("stress");
      trackTopic("well-being");
      response = randomChoice([
        "Sounds like you’ve had a tough day. Want to talk about it?",
        "Rest is important—maybe we can think of ways to relax together?",
        "I’m here if you want to vent or just chat quietly."
      ]);
    } else if (text.match(/\b(sad|down|blue|heartbroken|lonely)\b/)) {
      trackFeeling("sad");
      trackTopic("emotional support");
      response = randomChoice([
        "I’m sorry you’re feeling this way. I’m here to listen whenever you want.",
        "It’s okay to have those moments. You don’t have to go through it alone.",
        "Talking can help lighten the load. Want to try?"
      ]);
    } else if (text.match(/\b(happy|joyful|excited|cheerful|delighted)\b/)) {
      trackFeeling("happy");
      trackTopic("joy");
      response = randomChoice([
        "That’s awesome! What’s making you smile today?",
        "I love hearing good news. Share more!",
        "Your happiness is contagious!"
      ]);
    } else if (text.match(/\b(love|affection|care)\b/)) {
      trackFeeling("happy");
      trackTopic("love");
      response = randomChoice([
        "Love is powerful — what or who lights you up right now?",
        "Feeling connected is beautiful. Tell me more about it.",
        "I’m glad you have love in your life to hold on to."
      ]);
    } else if (text.match(/\b(help|support|need)\b/)) {
      trackFeeling("neutral");
      trackTopic("support");
      response = randomChoice([
        "What can I do to make things easier for you?",
        "Let’s figure this out together. Tell me what you need.",
        "You don’t have to do it all alone — I’m here."
      ]);
    } else if (text.match(/\b(bye|goodnight|see you|later)\b/)) {
      trackTopic("farewell");
      response = randomChoice([
        "Goodnight! Sweet dreams and take care.",
        "Catch you later! I’ll be here when you want to talk again.",
        "See you soon. Remember, you’re not alone."
      ]);
    } else {
      trackFeeling("neutral");
      trackTopic("conversation");
      const generalReplies = [
        "Tell me more about that.",
        "That’s really interesting, I want to hear more.",
        "I’m here for you no matter what.",
        "What do you think about it?",
        "That makes me curious — please go on.",
        "You’re doing great sharing this with me.",
        randomChoice(smallTalk)
      ];
      response = randomChoice(generalReplies);
    }

    updateEmotion();
    addToMemory(`<div class="bot">Bot: ${response}</div>`);
    return response;
  }
</script>
